<!doctype html>
<html lang="en" class="md">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, shrink-to-fit=no, viewport-fit=cover">

    <link rel="apple-touch-icon" href="img/f7-icon-square.html">
    <link rel="icon" href="img/f7-icon.html">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="vendor/bootstrap-4.1.3/css/bootstrap.min.css">

    <!-- Material design icons CSS -->
    <link rel="stylesheet" href="vendor/materializeicon/material-icons.css">

    <!-- swiper carousel CSS -->
    <link rel="stylesheet" href="vendor/swiper/css/swiper.min.css">

    <!-- app CSS -->
    <link id="theme" rel="stylesheet" href="css/style.css" type="text/css">


    <title>Doctors | Call & Cure</title>
</head>

<body class="color-theme-blue push-content-right theme-light">
    <section class="make-center">
        <button id="btn-stop-recording" style="display: none;">Stop Recording</button>
        <input type="text" style="display: none;" id="room-id" value="" autocorrect=off autocapitalize=off size=20>
        <!-- <a class="btn btn-success open_video" id="open_video" href="">
                                  <i class="fa fa-play"></i> Answer Call 
                                </a> -->
        <a class="btn btn-info calling-btn">
            <span class="material-icons">
                            pause
                            </span>
        </a>
        <a class="btn btn-danger close_video calling-btn" style="margin-right: 0;" onclick="location.href='appointment_list.html';">
            <span class="material-icons">call_end</span>
        </a>
        <!-- <button id="open_video" value=""> Open Video </button> -->
        <button id="open-room" style="display: none;"> Call Video To Patient </button>
        <button id="join-room" style="display: none;"></button>
        <button id="open-or-join-room" style="display: none;"></button>

        <div id="videos-container" style="margin: 20px 0;"></div>

        <div id="room-urls" style="text-align: center;display: none;background: #F1EDED;margin: 15px -10px;border: 1px solid rgb(189, 189, 189);border-left: 0;border-right: 0;"></div>
    </section>
    <div class="presc-btn">
        <a href="#presc-sec">
            <span class="material-icons">create</span></a>
    </div>
    <div id="presc-sec" class="container-fluid prescription">
        <div class="row">
            <div class="col-md-4 presc-content">
                <h2 class="block-title text-center">Chief Complain</h2>
                <br />
                <div class="table-responsive">
                    <table class="table table-bordered" id="notes_table">
                        <tr id="cc_notes">
                            
                        </tr>
                        <tr id='notesrow'>
                            <td contenteditable="true" class="cc_notes"></td>
                            <td width="5%"><button type="button" name="remove" data-row="notesrow" class="btn btn-danger btn-xs remove-row-notes">-</button></td>
                        </tr>
                        
                    </table>
                    <div class="text-right">
                        <button type="button" name="add" id="add-new-notes" class="btn btn-success btn-xs add-field">+</button>
                    </div>
                    <!-- <div id="inserted_item_data"></div> -->
                </div>
            </div>

            <div class="col-md-4 presc-content">
                <h2 class="block-title text-center">(H/O) Present illness</h2>
                <br />
                <div class="table-responsive">
                    <table class="table table-bordered" id="present_illness">
                        <tr id='horow'>
                            <td contenteditable="true" class="ho_pres"></td>
                            <td width="5%"><button type="button" name="remove" data-row="horow" class="btn btn-danger btn-xs remove-row-notes-ho">-</button></td>
                        </tr>
                    </table>
                    <div class="text-right">
                        <button type="button" name="add" id="add-new-notes-ho" class="btn btn-success btn-xs add-field">+</button>
                    </div>
                    <!-- <div id="inserted_item_data"></div> -->
                </div>
            </div>

                <div class="col-md-4 presc-content">
                <h2 class="block-title text-center">(H/O) Past illness</h2>
                <br />
                <div class="table-responsive">
                    <table class="table table-bordered" id="past_illness">
                        <tr id='horow_prev'>
                            <td contenteditable="true" class="ho_prev"></td>
                            <td width="5%"><button type="button" name="remove" data-row="horow_prev" class="btn btn-danger btn-xs remove-row-notes-ho-prev">-</button></td>
                        </tr>
                    </table>
                    <div class="text-right">
                        <button type="button" name="add" id="add-new-notes-ho-past" class="btn btn-success btn-xs add-field">+</button>
                    </div>
                    <!-- <div id="inserted_item_data"></div> -->
                </div>
            </div>

            <div class="col-md-4 presc-content">
                <h2 class="block-title text-center"> Provisional &Delta;</h2>
                <br />
                <div class="table-responsive">
                    <table class="table table-bordered" id="notes_table_ot">
                        <tr id='otrow'>
                            <td contenteditable="true" class="ot_notes"></td>
                            <td width="5%"><button type="button" name="remove" data-row="otrow" class="btn btn-danger btn-xs remove-row-notes-ot">-</button></td>
                        </tr>
                    </table>
                    <div class="text-right">
                        <button type="button" name="add" id="add-new-notes-ot" class="btn btn-success btn-xs add-field">+</button>
                    </div>
                    <!-- <div id="inserted_item_data"></div> -->
                </div>
            </div>


            <div class="col-md-4 presc-content">
                <h2 class="block-title text-center"> D/D </h2>
                <br />
                <div class="table-responsive">
                    <table class="table table-bordered" id="notes_table_dd">
                        <tr id='ddrow'>
                            <td contenteditable="true" class="dd_notes"></td>
                            <td width="5%"><button type="button" name="remove" data-row="ddrow" class="btn btn-danger btn-xs remove-row-notes-dd">-</button></td>
                        </tr>
                    </table>
                    <div class="text-right">
                        <button type="button" name="add" id="add-new-notes-dd" class="btn btn-success btn-xs add-field">+</button>
                    </div>
                    <!-- <div id="inserted_item_data"></div> -->
                </div>
            </div>


            <div class="col-md-4 presc-content">
                <h2 class="block-title text-center"> Investigation/s Advised</h2>
                <br />
                <div class="table-responsive">
                    <table class="table table-bordered" id="notes_table_ia">
                        <tr id='iarow'>
                            <td contenteditable="true" class="advised"></td>
                            <td width="5%"><button type="button" name="remove" data-row="iarow" class="btn btn-danger btn-xs remove-row-ia">-</button></td>
                        </tr>
                    </table>
                    <div class="text-right">
                        <button type="button" name="add" id="add-new-ia" class="btn btn-success btn-xs add-field">+</button>
                    </div>
                    <!-- <div id="inserted_item_data"></div> -->
                </div>
            </div>
            <div class="col-md-4 offset-md-4 presc-content">
                <h2 class="block-title text-center">Prescription</h2>
                <br />
                <div class="table-responsive">
                    <table class="table table-bordered" id="prescription_table">
                        <tr>
                            <th width="35%">Medicine</th>
                            <th>Power</th>
                            <th width="30%">Dose</th>
                            <th width="30%">Duration</th>
                            <th>Notes</th>
                            <th width="5%"></th>
                        </tr>
                        <tr id='row1'>
                            <td contenteditable="true" class="medicine_name"></td>
                            <td contenteditable="true" class="power"></td>
                            <td contenteditable="true" class="timez"></td>
                            <td contenteditable="true" class="quantity"></td>
                            <td contenteditable="true" class="notes"></td>
                            <td><button type="button" name="remove" data-row="row1" class="btn btn-danger btn-xs remove">-</button></td>
                        </tr>
                    </table>
                    <div class="text-right">
                        <button type="button" name="add" id="add" class="btn btn-success btn-xs add-field">+</button>
                    </div>
                </div>
            </div>
            <div class="col-md-4 presc-content">
                <h2 class="block-title text-center">Other Advice</h2>
                <br />
                <div class="table-responsive">
                    <table class="table table-bordered" id="advice_table">
                        <tr id='row0'>
                            <td contenteditable="true" class="advice"></td>
                            <td width="5%"><button type="button" name="remove" data-row="row0" class="btn btn-danger btn-xs remove-row">-</button></td>
                        </tr>
                    </table>
                    <div class="text-right">
                        <button type="button" name="add" id="add-new" class="btn btn-success btn-xs add-field">+</button>
                    </div>
                    <!-- <div id="inserted_item_data"></div> -->
                </div>
            </div>


            <div class="col-md-4 presc-content">
                <h2 class="block-title text-center"> Next Appointment Date</h2>
                <br />
                <div class="table-responsive">
                    <table class="table table-bordered" id="notes_table_ia">
                        <input type="date" id="next_appointment" class="form-control next_appointment text-whitw">
                    </table>
                </div>

                <br>
                <div class="center">
                    <button type="button" name="save" id="save" class="btn btn-info">Save</button>
                </div>
            </div>



        </div>
    </div>


    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="vendor/bootstrap-4.1.3/js/bootstrap.min.js"></script>

    <!-- Cookie jquery file -->
    <script src="vendor/cookie/jquery.cookie.js"></script>

    <!-- sparklines chart jquery file -->
    <script src="vendor/sparklines/jquery.sparkline.min.js"></script>

    <!-- Circular progress gauge jquery file -->
    <script src="vendor/circle-progress/circle-progress.min.js"></script>

    <!-- Swiper carousel jquery file -->
    <script src="vendor/swiper/js/swiper.min.js"></script>

    <!-- Application main common jquery file -->
    <script src="js/main.js"></script>

    <!-- page specific script -->

    <script type="text/javascript" src="cordova.js"></script>




    <!-- Main js all common file include -->
    <script src="js/doctorcustom.js"></script>
    <script src="js/live_webrtc/dist/RTCMultiConnection.js"></script>
    <script src="js/live_webrtc/node_modules/webrtc-adapter/out/adapter.js"></script>
    <!-- <script src="https://rtcmulticonnection.herokuapp.com/socket.io/socket.io.js"></script> -->
    <script src="socket.io.js"></script>

    <!-- custom layout for HTML5 audio/video elements -->
    <link rel="stylesheet" href="js/live_webrtc/dev/getHTMLMediaElement.css">
    <script src="js/live_webrtc/dev/getHTMLMediaElement.js"></script>
    <script src="js/live_webrtc/node_modules/recordrtc/RecordRTC.js"></script>
    <script src="js/live_webrtc/rtc_main.js"></script>
    <script src="https://cdn.webrtc-experiment.com/common.js"></script>

    <script>
        var url = window.location.href;
        var room_id = url.substring(url.lastIndexOf('=') + 1);

        $.ajax({
            url: "https://cncapp.devszone.com/index.php/api/video/get_details/",
            type: "POST",
            dataType: 'json',
            data: {
                'room_id': room_id,

            },
            success: function(data) {

                localStorage.setItem('appointments_id', data.appointment_id);
                localStorage.setItem('users_id', data.user_id);
                localStorage.setItem('doc_id', data.doctor_id);

                change_appointment_status(data.appointment_id);



            },
            error: function() {

            }

        });

        //     $(".open_video").on('click',function(e){
        //       e.preventDefault();
        // var appointment_doctor_video_id = 1;
        // // alert(appointment_doctor_video_id);
        //            $.ajax({
        //             type  : 'GET',
        //             url : 'https://localhost/CnC/api/video/open_video',
        //             async : false,
        //             dataType : 'json',
        //             data:{appointment_doctor_video_id:appointment_doctor_video_id},
        //             success: function(video_id) {
        //               if (video_id) {
        //                     // $('.open_video').html('Close Call');
        //                     $('.close_video').html('Close Call');
        //                     $("#open_video").attr("href",video_id);
        //               }




        //            }


        //          });

        //             event.preventDefault();
        //          });
    </script>


    <script>
        $(document).ready(function() {
            var count = 1;
            $('#add-new').click(function() {
                count++;
                var html_code = "<tr id='row" + count + "'>";
                html_code += "<td contenteditable='true' class='advice'></td>";
                html_code += "<td width='5%''><button type='button' name='remove' data-row='row" + count + "' class='btn btn-danger btn-xs remove-row'>-</button></td>";
                html_code += "</tr>";
                $('#advice_table').append(html_code);
            });

            $(document).on('click', '.remove-row', function() {
                var delete_row = $(this).data("row");
                $('#' + delete_row).remove();
            });



            var note_count = 1;
            $('#add-new-notes').click(function() {
                note_count++;
                var html_code = "<tr id='notesrow" + note_count + "'>";
                html_code += "<td contenteditable='true' class='cc_notes'></td>";
                html_code += "<td width='5%''><button type='button' name='remove' data-row='notesrow" + note_count + "' class='btn btn-danger btn-xs remove-row-notes'>-</button></td>";
                html_code += "</tr>";
                $('#notes_table').append(html_code);
            });

            $(document).on('click', '.remove-row-notes', function() {
                var delete_row = $(this).data("row");
                //alert(delete_row);
                $('#' + delete_row).remove();
            });


            var ho_note_count_present = 1;
            $('#add-new-notes-ho').click(function() {
                ho_note_count_present++;
                var html_code = "<tr id='horow" + ho_note_count_present + "'>";
                html_code += "<td contenteditable='true' class='ho_pres'></td>";
                html_code += "<td width='5%''><button type='button' name='remove' data-row='horow" + ho_note_count_present + "' class='btn btn-danger btn-xs remove-row-notes-ho'>-</button></td>";
                html_code += "</tr>";
                $('#present_illness').append(html_code);
            });

            $(document).on('click', '.remove-row-notes-ho', function() {
                var delete_row = $(this).data("row");
                //alert(delete_row);
                $('#' + delete_row).remove();
            });

            var ho_note_count_past = 1;
            $('#add-new-notes-ho-past').click(function() {
                ho_note_count_past++;
                var html_code = "<tr id='horow_prev" + ho_note_count_past + "'>";
                html_code += "<td contenteditable='true' class='ho_prev'></td>";
                html_code += "<td width='5%''><button type='button' name='remove' data-row='horow_prev" + ho_note_count_past + "' class='btn btn-danger btn-xs remove-row-notes-ho-prev'>-</button></td>";
                html_code += "</tr>";
                $('#past_illness').append(html_code);
            });

            $(document).on('click', '.remove-row-notes-ho-prev', function() {
                var delete_row = $(this).data("row");
                //alert(delete_row);
                $('#' + delete_row).remove();
            });


            var ot_note_count = 1;
            $('#add-new-notes-ot').click(function() {
                ot_note_count++;
                var html_code = "<tr id='otrow" + ot_note_count + "'>";
                html_code += "<td contenteditable='true' class='ot_notes'></td>";
                html_code += "<td width='5%''><button type='button' name='remove' data-row='otrow" + ot_note_count + "' class='btn btn-danger btn-xs remove-row-notes-ot'>-</button></td>";
                html_code += "</tr>";
                $('#notes_table_ot').append(html_code);
            });

            $(document).on('click', '.remove-row-notes-ot', function() {
                var delete_row = $(this).data("row");
                //alert(delete_row);
                $('#' + delete_row).remove();
            });


            var dd_note_count = 1;
            $('#add-new-notes-dd').click(function() {
                dd_note_count++;
                var html_code = "<tr id='ddrow" + dd_note_count + "'>";
                html_code += "<td contenteditable='true' class='dd_notes'></td>";
                html_code += "<td width='5%''><button type='button' name='remove' data-row='ddrow" + dd_note_count + "' class='btn btn-danger btn-xs remove-row-notes-dd'>-</button></td>";
                html_code += "</tr>";
                $('#notes_table_dd').append(html_code);
            });

            $(document).on('click', '.remove-row-notes-dd', function() {
                var delete_row = $(this).data("row");
                //alert(delete_row);
                $('#' + delete_row).remove();
            });


            var ia_count = 1;
            $('#add-new-ia').click(function() {
                ia_count++;
                var html_code = "<tr id='iarow" + ia_count + "'>";
                html_code += "<td contenteditable='true' class='advised'></td>";
                html_code += "<td width='5%''><button type='button' name='remove' data-row='iarow" + ia_count + "' class='btn btn-danger btn-xs remove-row-ia'>-</button></td>";
                html_code += "</tr>";
                $('#notes_table_ia').append(html_code);
            });

            $(document).on('click', '.remove-row-ia', function() {
                var delete_row = $(this).data("row");
                //alert(delete_row);
                $('#' + delete_row).remove();
            });
        });
        $(document).ready(function() {
            var count = 1;
            $('#add').click(function() {
                count++;
                var html_code = "<tr id='row" + count + "'>";
                html_code += "<td contenteditable='true' class='medicine_name'></td>";
                html_code += "<td contenteditable='true' class='power'></td>";
                html_code += "<td contenteditable='true' class='timez'></td>";
                html_code += "<td contenteditable='true' class='quantity'></td>";
                html_code += "<td contenteditable='true' class='notes'></td>";
                html_code += "<td><button type='button' name='remove' data-row='row" + count + "' class='btn btn-danger btn-xs remove'>-</button></td>";
                html_code += "</tr>";
                $('#prescription_table').append(html_code);
            });

            $(document).on('click', '.remove', function() {
                var delete_row = $(this).data("row");
                $('#' + delete_row).remove();
            });

            $('#save').click(function() {
                var doc_id = localStorage.getItem('doc_id');
                var user_id = localStorage.getItem('users_id');
                var appointment_id = localStorage.getItem('appointments_id');

                // console.log(user_id);
                // return false;
                var medicine_name = [];
                var timez = [];
                var quantity = [];
                var advice = [];
                var power = [];
                var notes = [];

                var cc_notes = [];
                var ho_pres = [];
                var ho_prev = [];
                var ot_notes = [];
                var advised = [];
                var next_appointment = [];
                var dd_notes = [];

                $('.medicine_name').each(function() {
                    medicine_name.push($(this).text());
                });
                $('.timez').each(function() {
                    timez.push($(this).text());
                });
                $('.quantity').each(function() {
                    quantity.push($(this).text());
                });
                $('.advice').each(function() {
                    advice.push($(this).text());
                });
                $('.power').each(function() {
                    power.push($(this).text());
                });

                $('.notes').each(function() {
                    notes.push($(this).text());
                });

                $('.cc_notes').each(function() {
                    cc_notes.push($(this).text());
                });

                $('.ho_pres').each(function() {
                    ho_pres.push($(this).text());
                });
                 $('.ho_prev').each(function() {
                    ho_prev.push($(this).text());
                });

                $('.ot_notes').each(function() {
                    ot_notes.push($(this).text());
                });

                $('.dd_notes').each(function() {
                    dd_notes.push($(this).text());
                });

                $('.advised').each(function() {
                    advised.push($(this).text());
                });

                var next_appointment = document.getElementById('next_appointment').value;

                $.ajax({
                    url: "http://localhost/CnC/api/Prescriptions/prescription",
                    method: "POST",
                    data: {
                        medicine_name: medicine_name,
                        timez: timez,
                        quantity: quantity,
                        doc_id: doc_id,
                        user_id: user_id,
                        appointment_id: appointment_id,
                        advice: advice,
                        power: power,
                        notes: notes,
                        cc_notes: cc_notes,
                        ho_pres: ho_pres,
                        ho_prev: ho_prev,
                        ot_notes: ot_notes,
                        dd_notes: dd_notes,
                        advised: advised,
                        next_appointment: next_appointment
                    },
                    success: function(data) {
                        location.href = 'appointment_list.html';

                    }
                });
            });
        });
    </script>
    <script type="text/javascript">

         var appointment_id = localStorage.getItem('appointments_id');

             $.ajax({
                url: "http://localhost/CnC/api/Presabout/cc_notes/" + appointment_id,
                type: "get",
                dataType: 'json',
                success: function(data) {
                    // console.log(data);
                    var symptoms=JSON.parse(data[0].symptoms);
                    var duration=JSON.parse(data[0].duration);

                    // console.log(symptoms);
                   var output = '';
                    for (var i = 0; i < symptoms.length ;i++) {
                        output += '<tr><td class="text-center">' + symptoms[i] + '</td><td class="text-center">' + duration[i] + '</td></tr>';
                    }

                    $('#cc_notes').html(output);
                    // var output = '';


                    // for (var i = 0; i < data.length; i++) {
                    //     output += '<tr><td class="text-center">' + data[i].symptoms + '</td><td class="text-left">' + data[i].duration + '</td></tr>';
                    // }
                    // $('#cc_notes').html(output);
                },
                error: function() {
                    //alert('failed');
                }

            });
    </script>



    <script>
        var connection = new RTCMultiConnection();

        // this line is VERY_important
        connection.socketURL = 'https://callncure.com:9001/';

        // if you want audio+video conferencing
        connection.session = {
            audio: true,
            video: true
        };

        // first step, ignore default STUN+TURN servers
        connection.iceServers = [];

        // second step, set STUN url
        connection.iceServers.push({
            urls: 'stun:stun4.l.google.com:19302'
        });

        // last step, set TURN url (recommended)
        connection.iceServers.push({
            urls: 'turn:turn.callncure.com',
            credential: '123456',
            username: 'estiak'
        });

        //connection.openOrJoin('your-room-id');
    </script>

    <script>
        function change_appointment_status(appointment_id) {
            $.ajax({
                url: "http://localhost/CnC/api/video/change_appointment_status/",
                type: "POST",
                dataType: 'json',
                data: {
                    'appointment_id': appointment_id,
                },
                success: function(data) {
                    // localStorage.setItem('appointments_id', data.appointment_id);
                    // localStorage.setItem('users_id', data.user_id);
                    // localStorage.setItem('doc_id', data.doctor_id);
                    // change_appointment_status(data.appointment_id);
                },
                error: function() {

                }

            });
        }
    </script>



</body>

</html>